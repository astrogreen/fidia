{% extends 'rest_framework/api.html' %}
{% load staticfiles %}
{% load rest_framework %}
{% load internal_extras %}
{% block title %} Schema Browser {% endblock %}
{% block head-extra %}
<link rel="stylesheet" type="text/css" href="{% static 'data_browser/css/sample/sample.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'data_browser/css/trait/trait.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'schema/css/schema/schema.min.css' %}"/>
{% endblock %}

{% block page_title %}Schema Browser{% endblock %}
{% block useful_links %}
<li role="presentation"><a href="{% url 'data_browser:root-list' %}">Data Browser</a></li>
{% endblock useful_links %}

{% block content-navigator-help %}
<a href="{% url 'schema:schema-list' %}" class=""><i class="fa fa-reply"></i> Back to Surveys</a>
{% endblock %}

{% block content-test %}
{% captureas survey %}{{response.data.sample}}{% endcaptureas %}

<div class="row schema-browser">
    <div class="col-sm-3 col-xs-12 menu-nav schema">
        <h5>Contents</h5>
        <ul class="nav nav-pills nav-stacked docs-sidebar" id="docs-sidebar">
            {% for trait_type_key, trait_type_value in response.data.schema.items %}
            <li class="text-uppercase heading {% if forloop.first %}no-margin-top{% endif %}">
                <h6>{{trait_type_key}}</h6>
            </li>
                {% for trait_qualifier_key, trait_qualifier_value in trait_type_value.items %}
                    <li class="{% if forloop.parentloop.first and forloop.first %}active{% endif %}" role="presentation">
                        <a href="#{{trait_type_key}}_{{trait_qualifier_key}}"
                           aria-controls="{{trait_type_key}}_{{trait_qualifier_key}}" role="tab"
                           data-toggle="pill">{{trait_qualifier_key|title}}
                            <!--<small>{{trait_type_key}}_{{trait_qualifier_key}}</small>-->
                        </a>
                    </li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
    <div class="col-sm-9 col-xs-12 right-panel">
        <div class="row">
            <div class="col-xs-12">
                <div class="title_info">
                    <h2>Schema for {{survey|uppercase}}
                        <small class="right-helper">
                            <!--<span class="sub-heading"><i class="fa fa-map-marker"></i> DR 1.0</span>&nbsp;&nbsp;-->
                            <div class="btn-group" role="group" style="margin-top:-15px;">
                                <button type="button" class="btn btn-default dropdown-toggle"
                                        data-toggle="dropdown"
                                        aria-haspopup="true" aria-expanded="false"><i class="fa fa-map-marker"></i> DR
                                    1.0
                                    <i class="fa fa-caret-down"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li class="disabled"><a href="">DR 1.0 &nbsp;
                                        <small class="sub-heading text-uppercase">Current</small>
                                    </a></li>
                                </ul>
                            </div>
                        </small>
                    </h2>
                    <p>The Schema Browser describes the {{survey|uppercase}} survey data products. It is recommended
                        that you also use the <a href="">{{survey|uppercase}} Documentation</a> in conjunction with the
                        Schema
                        Browser, which contains a more comprehensive description of pipeline reduction and analysis
                        techniques.
                    </p>
                </div>
            </div>
            <div class="col-xs-12 schema-contents">
                {% comment %}
                {% for trait_type_key, trait_type_value in response.data.schema.items %}
                    {{trait_type_key}}
                    {% for trait_qualifier_key, trait_qualifier_value in trait_type_value.items %}
                    &nbsp;{{trait_qualifier_key}}
                        {% for trait_branch_key, trait_branch_value in trait_qualifier_value.items %}
                            &nbsp;&nbsp;{{trait_branch_key}}
                                {% for trait_version_key, trait_version_value in trait_branch_value.items %}
                                    &nbsp;&nbsp;{{trait_version_key}}
                                    {{trait_version_value.pretty_name}}
                                {% endfor %}
                        {% endfor %}
                    {% endfor %}
                {% endfor %}
                {% endcomment %}
                <div class="tab-content">
                    {% for trait_type_key, trait_type_value in response.data.schema.items %}
                        {% for trait_qualifier_key, trait_qualifier_value in trait_type_value.items %}
                            <div id="{{trait_type_key}}_{{trait_qualifier_key}}" class="tab-pane branch_dropdown {% if forloop.parentloop.first and forloop.first %}active{% endif %} ">
                                <ul class="nav nav-pills pull-right">
                                    <li class="dropdown">
                                    <a class="btn btn-default" data-toggle="dropdown" href="#" aria-haspopup="true" aria-expanded="false">
                                       <i class="fa fa-code-fork"></i> Branch <i class="fa fa-caret-down"></i>
                                    </a>
                                    <ul class="dropdown-menu">
                                        {% for trait_branch_key, trait_branch_value in trait_qualifier_value.items %}
                                            <li class="dropdown-header">
                                                    <i class="fa fa-code-fork"></i> {{trait_branch_key}}
                                            </li>
                                            {% for trait_version_key, trait_version_value in trait_branch_value.items %}
                                                <li class="{% if forloop.parentloop.first and forloop.first %}active{% endif %}">
                                                    <a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}" data-toggle="tab" role="tab" style="padding-left:30px;">
                                                         <strong> {{trait_branch_key}}_{{trait_version_key}}</strong>
                                                    </a>
                                                </li>
                                            {% endfor %}
                                        {% endfor %}
                                    </ul>
                                  </li>
                                </ul>
                                <div class="tab-content">
                                    {% for trait_branch_key, trait_branch_value in trait_qualifier_value.items %}
                                        {% for trait_version_key, trait_version_value in trait_branch_value.items %}
                                            <div id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}"
                                                 class="tab-pane {% if forloop.parentloop.first and forloop.first %}active{% endif %}">
                                                    {% with trait_version_value as value %}

                                                        <h3>{{value.pretty_name}} {{trait_qualifier_key|title}}
                                                            <!--<small>{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}</small>-->
                                                        </h3>
                                                        <p><em>{% if value.description %}{{value.description}}{% endif %}</em></p>
                                                        <ul class="p">
                                                            <li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_description" class="scroll">Description</a></li>
                                                            <li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_properties" class="scroll">Properties</a></li>
                                                            <li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_versions" class="scroll">Versions</a></li>
                                                            <li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_formats" class="scroll">Formats</a></li>
                                                            <li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_branches" class="scroll">All Available Branches</a></li>
                                                        </ul>
                                                        <br>
                                                        <div class="panel panel-default success">
                                                            <div class="panel-body">
                                                                <div><em>{{trait_branch_key}}_{{trait_version_key}}</em> Branch description goes here.</div>
                                                                <br>
                                                                <div class="sub-heading">This document is for the {{value.pretty_name}} {{trait_qualifier_key|title}} branch <em>{{trait_branch_key}}</em>, which can be
                                                                    significantly different from other branches. To switch branches, use the
                                                                    branch selector floating in the top right corner of this panel. For more information
                                                                    on branches,
                                                                    <a href="{% url 'documentation:article-detail' slug='branches-what-is-a-branch' %}">
                                                                        view the documentation.</a>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <!-- Documentation -->
                                                        <h4 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_description">Description</h4>
                                                        <div class="well-ignore" style="margin-bottom:20px;">
                                                            {{value.html_documentation|safe}}
                                                            <hr>
                                                        </div>

                                                        <!-- Properties-->
                                                        <h4 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_properties">Properties</h4>
                                                        <table class="table table-bordered">
                                                            <tbody>
                                                                <tr class="active panel-title">
                                                                    <td>Name</td>
                                                                    <td>Description</td>
                                                                    <td>Type</td>
                                                                </tr>
                                                            {% for trait_property_key, trait_property_value in value.trait_properties.items %}
                                                            <tr>
                                                                <td>
                                                                    <strong class="text-uppercase">{{trait_property_value.pretty_name}}</strong>
                                                                </td>
                                                                <td class="p">
                                                                    {{trait_property_value.description}}
                                                                    <a class="">read more...</a>
                                                                </td>
                                                                <td class="p">
                                                                    {{trait_property_value.type}}
                                                                </td>
                                                            </tr>
                                                            {% endfor %}
                                                            </tbody>
                                                        </table>

                                                        <!-- Versions -->
                                                        <h4 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_versions">
                                                            Versions</h4>
                                                        <table class="table table-bordered">
                                                            <tbody>
                                                                <tr class="warning panel-title">
                                                                    <td><i class="fa fa-map-pin"></i> Version</td>
                                                                    <td>Description</td>
                                                                    <td>Date</td>
                                                                </tr>

                                                                {% for trait_version_key, trait_version_value in trait_branch_value.items %}
                                                                    <tr class="p">
                                                                        <td>
                                                                            {{trait_version_key}}
                                                                        </td>
                                                                        <td>
                                                                            <em>version description</em>
                                                                            <a class="">read more...</a>
                                                                        </td>
                                                                        <td>
                                                                            <em>version date</em>
                                                                        </td>
                                                                    </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                        </table>

                                                        <!-- Formats -->
                                                        <h4 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_formats">
                                                             Formats
                                                        </h4>
                                                        <table class="table table-bordered">
                                                            <tbody>
                                                                <tr class="success panel-title">
                                                                    <td><span class="fa-custom-stack">
                                                                  <i class="fa fa-file-o"></i>
                                                                    <span class="fa-custom-filetype">fits</span>
                                                                </span>
                                                                        Format
                                                                    </td>
                                                                    <td>Description</td>
                                                                </tr>

                                                            {% for trait_version_key, trait_version_value in trait_branch_value.items %}
                                                                    <tr>
                                                                        <td></td>
                                                                        <td></td>
                                                                    </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                        </table>


                                                        <!-- Branches -->
                                                        <h4 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_branches">
                                                             All Available Branches
                                                        </h4>
                                                        <p>{{trait_type_key}} {{trait_qualifier_key}} has X available branch(es).

                                                            To switch branches, use the
                                                            branch selector floating in the top right corner at the top
                                                            of this document. For more information
                                                            on branches,
                                                            <a href="{% url 'documentation:article-detail' slug='branches-what-is-a-branch' %}">
                                                                view the documentation</a>.
                                                        </p>


                                                        {% for trait_branch_key, trait_branch_value in trait_qualifier_value.items %}
                                                            <h5><i class="fa fa-code-fork"></i> {{trait_branch_key}}</h5>
                                                            <p>branch description goes here</p>
                                                            <h6>Versions:</h6>
                                                            {% for trait_version_key, trait_version_value in trait_branch_value.items %}
                                                                <em>{{trait_version_key}}</em>
                                                            {% endfor %}
                                                        {% endfor %}

                                                    {% endwith %}

                                            </div>
                                        {% endfor %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block footer-extra %}
<script>

    $(window).on('resize, load', function () {
        // Sidebar menu height is at least panel height
        if ($(window).width() > 770) {
            if ($('.menu-nav').height()<$('.right-panel').height()){
                $('.menu-nav').height($('.right-panel').height() + 'px');
            }
        } else {$('.menu-nav').height('auto')}
    });


    $(document).ready(function () {
        $("ul.nav-pills a").click(function (e) {
          e.preventDefault();
            $(this).tab('show');
        });
        // Internally linked tab navigation (for branches and versions)
         $('.branch_dropdown > ul > li > a').click(function(){
             console.log('click');
         });
        // Change the text shown in the branch button.
         $('.branch_dropdown ul.dropdown-menu > li > a').click(function(event){
            $('.branch_dropdown > ul > li > a').html("<i class='fa fa-code-fork'></i> Branch: "+"<strong>"+$( this ).text()+"</strong>")
         });

        $(".scroll").click(function(event){
            // stop the hash being appended to the url, and scroll to the value
            event.preventDefault();
            $('html, body').animate({scrollTop:$(this.hash).offset().top}, 800);
        });
    });

</script>
{% endblock %}
