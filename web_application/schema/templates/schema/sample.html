{% extends 'rest_framework/api.html' %}
{% load staticfiles %}
{% load rest_framework %}
{% load internal_extras %}
{% block title %} Schema Browser {% endblock %}
{% block head-extra %}
<link rel="stylesheet" type="text/css" href="{% static 'data_browser/css/sample/sample.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'data_browser/css/trait/trait.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'schema/css/schema/schema.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'restapi_app/css/documentation-fidia/documentation-fidia.min.css' %}"/>
{% endblock %}

{% block page_title %}Schema Browser{% endblock %}
{% block useful_links %}
<li role="presentation"><a href="{% url 'data_browser:root-list' %}">Data Browser</a></li>
{% endblock useful_links %}

{% block content_render %}
{% captureas survey %}{{response.data.sample}}{% endcaptureas %}

<div class="row schema-browser" id="top-of-page">
    <div class="col-xs-12">
        <div class="title_info">
            <h2>Schema for {{survey|uppercase}} DR 1.0
                <small class="right-helper">
                    <!--<span class="sub-heading"><i class="fa fa-map-marker"></i> DR 1.0</span>&nbsp;&nbsp;-->
                    <div class="btn-group" role="group" style="margin-top:-15px;">
                        <button type="button" class="btn btn-default dropdown-toggle"
                                data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                            <span class="sub-heading">
                                <i class="fa fa-map-marker"></i> Data Release
                            </span>
                            <strong>1.0</strong>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li class="disabled"><a href="">Data Release 1.0 &nbsp;
                                <small class="sub-heading text-uppercase">Current</small>
                            </a></li>
                        </ul>
                    </div>
                </small>
            </h2>
            <p>The Schema Browser describes the {{survey|uppercase}} survey data products. It is recommended
                that you also use the <a href="">{{survey|uppercase}} Documentation</a> in conjunction with the
                Schema
                Browser, which contains a more comprehensive description of pipeline reduction and analysis
                techniques.
            </p>
        </div>
    </div>


    <a class="scroll" href="#top-of-page" id="back-to-top">
        <i class="fa fa-angle-double-up"></i>
        back to top
    </a>

    <div class="col-sm-3 col-xs-12 menu-nav schema" id="menu-nav">
        <h5>Contents</h5>
        <ul class="nav nav-pills nav-stacked docs-sidebar" id="docs-sidebar">
            {% for trait_type_key, trait_type_value in response.data.schema.trait_types.items %}
            <li class="text-uppercase heading {% if forloop.first %}no-margin-top{% endif %}">
                <h6>{{trait_type_value.pretty_name}}</h6>
            </li>
                {% for trait_qualifier_key, trait_qualifier_value in trait_type_value.trait_qualifiers.items %}
                    <li class="{% if forloop.parentloop.first and forloop.first %}active{% endif %}" role="presentation">
                        <a href="#{{trait_type_key}}_{{trait_qualifier_key}}" class="trait_type_button"
                           aria-controls="{{trait_type_key}}_{{trait_qualifier_key}}" role="tab"
                           data-toggle="pill">{{trait_qualifier_value.pretty_name}}
                            {% if not trait_qualifier_value.pretty_name %}
                                {{trait_type_value.pretty_name}}
                            {% endif %}
                            <!--<small>{{trait_type_key}}_{{trait_qualifier_key}}</small>-->
                        </a>
                    </li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
    <div class="col-sm-9 col-xs-12 right-panel">
        <div class="row">
            <div class="col-xs-12 schema-contents">

                <div class="tab-content trait">
                    {% for trait_type_key, trait_type_value in response.data.schema.trait_types.items %}
                        {% for trait_qualifier_key, trait_qualifier_value in trait_type_value.trait_qualifiers.items %}
                            <div id="{{trait_type_key}}_{{trait_qualifier_key}}" class="tab-pane branch_dropdown {% if forloop.parentloop.first and forloop.first %}active{% endif %} ">

                                <h2>{{trait_type_value.pretty_name}} {{trait_qualifier_value.pretty_name}}</h2>
                                <p><em>{{trait_type_value.description}}</em></p>

                                <div class="panel panel-default success branch_warning">
                                    <div class="panel-body">
                                        <div class="sub-heading">This document is for the {{trait_type_value.pretty_name}} {{trait_qualifier_value.pretty_name}}
                                    <strong> branch <em><span class="branch_warning-branch"></span></em>, version <em><span class="branch_warning-version"></span></em></strong>, which can be
                                            significantly different from other branches/versions. To switch branches/versions, use the
                                            selector floating in the top right corner of this panel. For more information
                                            on branches,
                                            <a href="{% url 'documentation:article-detail' slug='branches-what-is-a-branch' %}">
                                                view the documentation.</a><br>
                                            <a href="" role="button" class="branch_warning_button pull-right">Hide this message</a>
                                        </div>
                                    </div>
                                </div>
                                <ul class="nav nav-pills branch-selector">
                                    <li class="dropdown">
                                        <a class="btn btn-default branch_button" data-toggle="dropdown" href="#" aria-haspopup="true" aria-expanded="false">
                                           <span class="sub-heading"><i class="fa fa-code-fork"></i> Branch </span>
                                                {% for trait_branch_key, trait_branch_value in trait_qualifier_value.branches.items %}
                                                    <!--Default branch, and the default version for that branch, are set as active-->
                                                    {% if trait_qualifier_value.default_branch == trait_branch_key %}
                                                        <strong>{{trait_branch_value.pretty_name}}{% if trait_branch_value.description %}: {% endif %}</strong>
                                                        {{trait_branch_value.description}}
                                                    {% endif %}
                                                {% endfor %}
                                            <i class="fa fa-caret-down"></i>
                                        </a>
                                        <ul class="dropdown-menu" style="margin-top:0;padding-top:0;">

                                            <li class="dropdown-header dropdown-header-bold">
                                                Change branch
                                            </li>
                                            {% for trait_branch_key, trait_branch_value in trait_qualifier_value.branches.items %}
                                                {% for trait_version_key, trait_version_value in trait_branch_value.versions.items %}

                                                <!--Default branch, and the default version for that branch, are set as active-->
                                                <li class="{% if trait_qualifier_value.default_branch == trait_branch_key %}active{% endif %}">
                                                    <a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}"
                                                       data-toggle="tab" role="tab" data-branch="{{trait_branch_value.pretty_name}}" data-branch-description="{{trait_branch_value.description}}">
                                                        <strong> {{trait_branch_value.pretty_name}}
                                                        {% if trait_qualifier_value.default_branch == trait_branch_key %}
                                                            <small>DEFAULT</small>
                                                        {% endif %}
                                                        </strong>
                                                    </a>
                                                </li>
                                                {% endfor %}

                                                {% if not forloop.last %}
                                                    <li role="separator" class="divider"></li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </li>
                                </ul>

                                <div class="tab-content">

                                    {% for trait_branch_key, trait_branch_value in trait_qualifier_value.branches.items %}

                                        <div id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}" class="tab-pane {% if trait_qualifier_value.default_branch == trait_branch_key %}active{% endif %} ">
                                            <ul class="nav nav-pills version-selector">
                                                <li class="dropdown">
                                                    <a class="btn btn-default branch_button" data-toggle="dropdown" href="#" aria-haspopup="true" aria-expanded="false">
                                                        {% for trait_version_key, trait_version_value in trait_branch_value.versions.items %}
                                                                <!--Default branch, and the default version for that branch, are set as active-->
                                                            {% if trait_branch_value.default_version == trait_version_key %}
                                                                <span class="sub-heading"><i class="fa fa-map-pin"></i> Version</span>  <strong> {{trait_version_value.pretty_name}}{% if trait_version_value.description %}: {% endif %}</strong> {{trait_version_value.description}}
                                                            {% endif %}
                                                        {% endfor %}
                                                        <i class="fa fa-caret-down"></i>
                                                    </a>
                                                    <ul class="dropdown-menu" style="margin-top:0;padding-top:0;">

                                                        <li class="dropdown-header dropdown-header-bold">
                                                            Change version
                                                        </li>
                                                        {% for trait_version_key, trait_version_value in trait_branch_value.versions.items %}
                                                                <!--Default branch, and the default version for that branch, are set as active-->
                                                            <li class="{% if trait_branch_value.default_version == trait_version_key %}active{% endif %}">
                                                                <a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}"
                                                                   data-toggle="tab" role="tab" data-branch="{{trait_branch_value.pretty_name}}" data-version="{{trait_version_value.pretty_name}}" data-version-description="{{trait_version_value.description}}">
                                                                    <strong> {{trait_version_value.pretty_name}}
                                                                    {% if trait_branch_value.default_version == trait_version_key %}
                                                                        <small>LATEST</small>
                                                                    {% endif %}
                                                                    </strong>
                                                                </a>
                                                            </li>
                                                            {% if not forloop.last %}
                                                                <li role="separator" class="divider"></li>
                                                            {% endif %}
                                                        {% endfor %}
                                                            <!--<li role="separator" class="divider"></li>-->
                                                            <!--<li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_dummy" data-toggle="tab" role="tab" data-branch="{{trait_branch_value.pretty_name}}" data-version="dummy">Dummy</a></li>-->
                                                    </ul>
                                                </li>
                                            </ul>
                                            <div class="tab-content">
                                                {% for trait_version_key, trait_version_value in trait_branch_value.versions.items %}
                                                <div id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}" class="tab-pane {% if trait_branch_value.default_version == trait_version_key %}active{% endif %} ">

                                                        {% with trait_version_value.trait as value %}

                                                            <p>{% if value.description %}{{value.description}}{% endif %}</p>

                                                            <p>You are currently viewing the {{trait_type_value.pretty_name}}
                                                                {{trait_qualifier_value.pretty_name}} Schema for
                                                                branch <strong class="text-danger"><em>{{trait_branch_value.pretty_name}}
                                                                </em></strong>, version number <strong class="text-danger">
                                                                    <em>{{trait_version_value.pretty_name}}</em></strong>.
                                                                {% if trait_qualifier_value.default_branch == trait_branch_key %}
                                                                    The {{trait_branch_value.pretty_name}} branch is the default branch for all {{trait_type_value.pretty_name}} {{trait_qualifier_value.pretty_name}} products.
                                                                {% endif %}
                                                            </p>

                                                            <h3>Contents</h3>
                                                            <ul class="p">
                                                                <li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_description" class="scroll">Description</a></li>
                                                                <li>
                                                                    <a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_properties"
                                                                       class="scroll">Properties</a>
                                                                    <ul>
                                                                        {% for trait_property_key, trait_property_value in value.trait_properties.items %}
                                                                            <li><a class="scroll" href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{trait_property_key}}">{{trait_property_value.pretty_name}} </a></li>
                                                                        {% endfor %}
                                                                        {% for sub_trait_key, sub_trait_value in value.sub_traits.items %}
                                                                            <li><a class="scroll" href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{sub_trait_key}}">{{sub_trait_value.pretty_name}} </a></li>
                                                                            {% comment %}
                                                                                <!--<ul>-->
                                                                                    <!--{% for sub_trait_qualifier_key, sub_trait_qualifier_value in sub_trait_value.trait_qualifiers.items %}-->
                                                                                        <!--{% if sub_trait_qualifier_value.pretty_name %}-->
                                                                                            <!--&lt;!&ndash;Only add this level in if it exists&ndash;&gt;-->
                                                                                            <!--<li>-->
                                                                                                <!--<a class="scroll" href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{sub_trait_key}}_{{sub_trait_qualifier_key}}">{{sub_trait_qualifier_value.pretty_name}}</a>-->
                                                                                            <!--</li>-->
                                                                                            <!--<ul>-->
                                                                                        <!--{% endif %}-->
                                                                                        <!--&lt;!&ndash; here, can access the trait description, pretty name etc&ndash;&gt;-->
                                                                                            <!--{% with sub_trait_qualifier_value.trait as sub_value %}-->
                                                                                                <!--&lt;!&ndash;{% if sub_trait_value.pretty_name != sub_value.pretty_name %}&ndash;&gt;-->
                                                                                                    <!--&lt;!&ndash; Here, we can access the any description levels that may be apparent &ndash;&gt;-->
                                                                                                    <!--<li><a class="scroll" href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{sub_trait_key}}_{{sub_trait_qualifier_key}}_{{sub_trait_value.pretty_name}}">{{sub_value.pretty_name}}</a></li>-->
                                                                                                    <!--<ul>-->
                                                                                                <!--&lt;!&ndash;{% endif %}&ndash;&gt;-->
                                                                                                    <!--{% for sub_trait_property_key, sub_trait_property_value in sub_value.trait_properties.items %}-->
                                                                                                        <!--<li><a class="scroll" href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{sub_trait_key}}_{{sub_trait_qualifier_key}}_{{sub_trait_property_key}}">{{sub_trait_property_value.pretty_name}} </a></li>-->
                                                                                                    <!--{% endfor %}-->
                                                                                                <!--&lt;!&ndash;{% if sub_trait_value.pretty_name != sub_value.pretty_name %}&ndash;&gt;-->
                                                                                                    <!--</ul>-->
                                                                                                <!--&lt;!&ndash;{% endif %}&ndash;&gt;-->
                                                                                            <!--{% endwith %}-->
                                                                                        <!--{% if sub_trait_qualifier_value.pretty_name %}-->
                                                                                            <!--</ul>-->
                                                                                        <!--{% endif %}-->
                                                                                    <!--{% endfor %}-->
                                                                                <!--</ul>-->
                                                                            {% endcomment %}
                                                                        {% endfor %}
                                                                    </ul>
                                                                </li>
                                                                <li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_formats" class="scroll">Downloadable Formats</a></li>
                                                                <li><a href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_branches" class="scroll">All Available Branches and Previous Versions</a></li>
                                                            </ul>

                                                            <!-- Documentation -->
                                                            <h3 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_description">Description</h3>
                                                            <div class="documentation_fidia">
                                                                {{value.html_documentation|safe}}
                                                            </div>

                                                            <!-- Properties-->
                                                            <h3 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_properties">Properties</h3>


                                                            {% for trait_property_key, trait_property_value in value.trait_properties.items %}
                                                                <h4 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{trait_property_key}}">
                                                                {{trait_property_value.pretty_name}} <small> <code>{{trait_property_value.type}}</code></small></h4>
                                                                <div class="documentation_fidia">
                                                                    {{trait_property_value.html_documentation|safe}}
                                                                </div>
                                                            {% endfor %}


                                                            <!--Sub traits-->
                                                            {% for sub_trait_key, sub_trait_value in value.sub_traits.items %}
                                                                <h4 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{sub_trait_key}}">
                                                                {{sub_trait_value.pretty_name}}</h4>
                                                                <div class="documentation_fidia">
                                                                    {{sub_trait_value.html_documentation|safe}}
                                                                </div>

                                                                {% for sub_trait_qualifier_key, sub_trait_qualifier_value in sub_trait_value.trait_qualifiers.items %}

                                                                    <!--{% if sub_trait_qualifier_value.pretty_name %}-->
                                                                        <!--Only add this level in if it exists-->
                                                                        <!--<li>-->
                                                                            <!--<a class="scroll" href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{sub_trait_key}}_{{sub_trait_qualifier_key}}">{{sub_trait_qualifier_value.pretty_name}}</a>-->
                                                                        <!--</li>-->
                                                                    <!--{% endif %}-->
                                                                    <!-- here, can access the trait description, pretty name etc-->
                                                                        {% with sub_trait_qualifier_value.trait as sub_value %}
                                                                            <!--{% if sub_value.description %}-->
                                                                                <p><em>{{sub_value.description}}</em></p>
                                                                            <!--{% endif %}-->
                                                                            <!--{% if sub_value.html_documentation %}-->
                                                                                <div class="documentation_fidia">{{sub_value.html_documentation|safe}}</div>
                                                                            <!--{% endif %}-->

                                                                            <div>
                                                                                <h5 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{sub_trait_key}}_{{sub_trait_qualifier_key}}_{{sub_trait_value.pretty_name}}">
                                                                                    &nbsp;&nbsp;<i class="fa fa-level-up fa-rotate-90"></i> {{sub_trait_value.pretty_name}} Properties</h5>
                                                                                <!-- Here, we can access the any description levels that may be apparent -->
                                                                                <div class="documentation_fidia">{{sub_trait_value.html_documentation|safe}}</div>
                                                                                    <div class="table-responsive" style="padding-left:15px;">
                                                                                        <table class="table table-bordered table-striped">
                                                                                            <colgroup>
                                                                                                <col style="width:15%">
                                                                                                <col style="width:5%">
                                                                                                <col style="width:20%">
                                                                                                <col style="width:50%">
                                                                                            </colgroup>
                                                                                            <thead>
                                                                                            <tr>
                                                                                                <th>Name</th>
                                                                                                <th>Type</th>
                                                                                                <th>Description</th>
                                                                                                <th>Documentation</th>
                                                                                            </tr>
                                                                                            </thead>
                                                                                            <tbody>

                                                                                            {% for sub_trait_property_key, sub_trait_property_value in sub_value.trait_properties.items %}
                                                                                                <tr>
                                                                                                    <td>{{sub_trait_property_value.pretty_name}}</td>
                                                                                                    <td><code>{{sub_trait_property_value.type}}</code></td>
                                                                                                    <td><em>{{sub_trait_property_value.description}}</em></td>
                                                                                                    <td><span class="documentation_fidia">{{sub_trait_property_value.html_documentation|safe}}</span></td>
                                                                                                    <!--<td><a class="scroll" href="#{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_{{trait_property_key}}"> <i class="fa fa-link"></i> Read more </a></td>-->
                                                                                                </tr>
                                                                                            {% endfor %}
                                                                                            </tbody>
                                                                                        </table>
                                                                                    </div>
                                                                            </div>

                                                                        {% endwith %}

                                                                {% endfor %}


                                                            {% endfor %}

                                                            <!-- Formats -->
                                                            <h3 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_formats">
                                                                 Formats
                                                            </h3>
                                                            <div>
                                                                <span class="fa-custom-stack">
                                                                  <i class="fa fa-file-o"></i>
                                                                    <span class="fa-custom-filetype">fits</span>
                                                                </span><i class="fa fa-check sub-heading"></i>&nbsp;&nbsp;
                                                                <span class="fa-custom-stack">
                                                                  <i class="fa fa-file-o"></i>
                                                                    <span class="fa-custom-filetype">json</span>
                                                                </span><i class="fa fa-check sub-heading"></i>
                                                            </div>
                                                            <p> You can download {{trait_type_value.pretty_name}} {{trait_qualifier_value.pretty_name}}-type data products in fits and json formats.

                                                            </p>


                                                            <!-- Branches -->
                                                            <h3 id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_branches">
                                                                 All Available Branches and Previous Versions
                                                            </h3>
                                                            <p>{{trait_type_value.pretty_name}} {{trait_qualifier_value.pretty_name}} data products have {{trait_qualifier_value.branches |length }} available branch(es).
                                                                In this section, you may find descriptions of each branch and version for reference.

                                                                To switch branches, use the
                                                                branch selector floating in the top right corner at the top
                                                                of this document. For more information
                                                                on branches,
                                                                <a href="{% url 'documentation:article-detail' slug='branches-what-is-a-branch' %}">
                                                                    view the documentation</a>.
                                                            </p>
                                                            <div class="table-responsive">
                                                                <table class="table table-bordered table-striped">
                                                                    <colgroup>
                                                                        <col style="width:20%">
                                                                        <col style="width:30%">
                                                                        <col style="width:50%">
                                                                    </colgroup>
                                                                    <thead>
                                                                    <tr>
                                                                        <th><i class="fa fa-code-fork"></i> Branch</th>
                                                                        <th>Description</th>
                                                                        <th><i class="fa fa-map-pin"></i> Versions</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                    {% for trait_branch_key, trait_branch_value in trait_qualifier_value.branches.items %}
                                                                         <tr>
                                                                            <td>{{trait_branch_value.pretty_name}}
                                                                                {% if trait_qualifier_value.default_branch == trait_branch_key %}
                                                                                    <small>DEFAULT</small>
                                                                                {% endif %}
                                                                            </td>
                                                                            <td>{{trait_branch_value.description}}</td>
                                                                             <td>
                                                                                 <ul>
                                                                                    {% for trait_version_key, trait_version_value in trait_branch_value.versions.items %}
                                                                                        <li>
                                                                                            <span>
                                                                                                {{trait_version_value.pretty_name}}
                                                                                                {% if trait_branch_value.default_version == trait_version_key %}
                                                                                                    <small>LATEST</small>
                                                                                                {% endif %}
                                                                                            </span><br>
                                                                                            <em>{{trait_version_value.description}}</em>
                                                                                        </li>

                                                                                    {% endfor %}
                                                                                 </ul>

                                                                             </td>
                                                                        </tr>
                                                                    {% endfor %}

                                                                    </tbody>
                                                                </table>
                                                            </div>

                                                        {% endwith %}
                                                </div>
                                                {% endfor %}
                                                <!--<div id="{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_dummy" class="tab-pane">-->
                                                    <!--{{trait_type_key}}_{{trait_qualifier_key}}_{{trait_branch_key}}_{{trait_version_key}}_dummy-->
                                                <!--</div>-->
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block footer-extra %}
<script>

    update_menu_nav_size = function(){
        // Sidebar menu height is at least right-panel height (but not smaller than the menu contents)
        if ($(window).width() > 770) {
            if ($('.right-panel').height()>$('#docs-sidebar').height()){
                $('.menu-nav').height($('.right-panel').height() + 'px');
            }
        } else {
            $('.menu-nav').height($('#docs-sidebar').height()+30+'px');
        }
    };

    $(window).load(function () {
        update_menu_nav_size();
    });
    $(window).resize(function () {
        update_menu_nav_size();
    });

    $(document).ready(function () {

        // Activate a tab if the hash is in the url
        if (window.location.hash.length > 0) {
            $('ul.nav-pills > li > a.trait_type_button[href="' + window.location.hash + '"]').tab('show');
        }

        $("ul.nav-pills a.trait_type_button").click(function (e) {
            // add the has to the url once trait_type is selected
            window.location.hash = this.hash;
        });

        $("ul.nav-pills a").click(function (e) {
            e.preventDefault();
            $(this).tab('show');
            // update the menu size
            update_menu_nav_size();
        });

        // Change the text shown in the branch button.
        $('.branch_dropdown ul.dropdown-menu > li > a').click(function (event) {

            // note, currentTarget gets the element to which the event handler was attached to (rather than target, which gets the element on which the event occurred)
            var _anchor = $(event.currentTarget);
            // get nearest button

            // optional version description
            var _vers_description_colon = '';
            var _branch_description_colon = '';
            if (!!_anchor.attr('data-version-description')){_vers_description_colon=':'}
            if (!!_anchor.attr('data-branch-description')){_branch_description_colon=':'}

            var _branch = "<span class='sub-heading'><i class='fa fa-code-fork'></i> Branch </span><strong>" + _anchor.attr('data-branch') + _branch_description_colon + "</strong> " + _anchor.attr('data-branch-description') + " <i class='fa fa-caret-down'></i>";
            var _version = "<span class='sub-heading'><i class='fa fa-map-pin'></i> Version </span><strong>" + _anchor.attr('data-version') + _vers_description_colon + "</strong> " + _anchor.attr('data-version-description') + " <i class='fa fa-caret-down'></i>";

            if (!!_anchor.attr('data-version')){
                _anchor.closest('ul.version-selector').find('a.branch_button').html(_version)
            } else {
                _anchor.closest('ul.branch-selector').find('a.branch_button').html(_branch)
            }

            // Update the branch_warning message with this branch and version
            _anchor.closest('.trait').find('span.branch_warning-branch').html(_anchor.attr('data-branch'));
            _anchor.closest('.trait').find('span.branch_warning-version').html(_anchor.attr('data-version'));

        });

        update_branch_warning_message = function(){
            /**
             * Updates the branch warning message with the current branch and version
             * @type {any}
             * @private
             */
            var _data_branch = $('.trait > .active').find('ul.branch-selector > li > ul > li.active a').attr('data-branch');
            var _data_version = $('.trait > .active').find('ul.version-selector > li > ul > li.active a').attr('data-version');

            $('.trait > .active').find('span.branch_warning-branch').html(_data_branch);
            $('.trait > .active').find('span.branch_warning-version').html(_data_version);

        };

        // ON LOAD Find the branch_warning message and update with this branch and version
        update_menu_nav_size();
        update_branch_warning_message();

        // ON TRAIT TYPE SELECTION
        $('.trait_type_button').click(function(){
            update_menu_nav_size();
            update_branch_warning_message();
        });


        // Smooth scrolling
        $(".scroll").click(function(event){
            // stop the hash being appended to the url, and scroll to the value
            event.preventDefault();
            $('html, body').animate({scrollTop:$(this.hash).offset().top}, 800);
        });

        // Hide branch warning message
        $('.branch_warning_button').click(function(){
            $('.branch_warning').hide();
        });


    });

    

</script>
{% endblock %}
