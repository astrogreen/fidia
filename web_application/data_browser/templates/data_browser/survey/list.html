{% extends 'rest_framework/api.html' %}
{% load staticfiles %}
{% load rest_framework %}
{% load internal_extras %}
{% block title %}Data Browser{% endblock %}
{% block head-extra %}
<link rel="stylesheet" type="text/css" href="{% static 'data_browser/css/sample/sample.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'data_browser/css/trait/trait.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'restapi_app/css/selectize/selectize.css' %}"/>
{% endblock %}

{% block page_title %}Data Browser{% endblock %}
{% block useful_links %}
{% captureas survey %}{{response.data.sample}}{% endcaptureas %}
<li role="presentation" ><a href="{% url 'schema:sample-list' sample_pk=survey %}">Schema</a></li>
<li role="presentation" ><a href="{% url 'documentation:topic-detail' slug=survey %}">Documentation</a></li>
{% endblock useful_links %}

{% block content-navigator-help %}
    <a href="{% url 'data_browser:root-list' %}"><i class="fa fa-reply"></i> Back to Surveys</a>
{% endblock %}

{% block content_render %}
{% captureas survey %}{{response.data.sample}}{% endcaptureas %}
<div class="row headline">
    <div class="col-xs-12 col-sm-12">
         <h2>{{survey|uppercase}} <small><span><i class="fa fa-map-marker"></i> {{response.data.version}}</span></small></h2>
    </div>
    <div class="text-right col-xs-12 col-sm-12 options">
        <span class="branch_version">
            <a href="{% url 'documentation:topic-detail' slug='data-central-syntax' %}" class="question"><i class="fa fa-question-circle"></i> What's a data release?</a> &nbsp;&nbsp;
            <span class="sub-heading" style="font-size:16px;"><i class="fa fa-map-marker"></i>{{response.data.version}}</span>
        </span>

        <div class="btn-group" role="group" aria-label="...">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-map-marker"></i> Data Releases <i class="fa fa-caret-down"></i>
                </button>
                <ul class="dropdown-menu">
                    {% for i in response.data.data_release_versions %}
                        {% if i == response.data.version %}
                            <li class="disabled"><a href="{% url 'data_browser:survey-list' sample_pk=survey %}">{{response.data.version}} &nbsp; <small class="sub-heading text-uppercase">Current</small></a></li>
                        {% else %}
                            <li><a href="{% url 'data_browser:survey-list' sample_pk=survey %}">{{i}}</a></li>
                        {% endif %}
                    {% endfor %}

                    {% for branch_name, branch_url in value.branches.items %}
                    <li><a href="{{branch_url}}">{{branch_name}}</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xs-12">
        <div class="panel panel-default" style="margin-top:20px;">
            <div class="panel-heading">
                Overview
            </div>
            <div class="table-responsive">
                <table class="table table-overview">
                    <tbody>
                    <tr>
                        <td><img class="img-responsive sami-logo"  src="/static/restapi_app/img/logo/logo-{{survey}}.png"></td>
                        <td class="lead">{% with "data_browser/survey/survey/"|add:survey|add:"/pi.html" as template %}
                        {% include template %}
                        {% endwith %}</td>
                        <td class="lead">{{response.data.version}}</td>
                        <td class="lead">{{response.data.astro_objects | length}}</td>
                        <td class="lead"><a href="{% url 'schema:sample-list' sample_pk=survey %}">per Object</a>
                        </td>
                        <td class="lead">
                            {% for f in available_formats %}
                                {% if f != "api" %}
                                    <a href="{{request.get_full_path}}?format={{f}}" class="btn btn-default">
                                        <span class="fa-custom-stack">
                                          <i class="fa fa-file-o"></i>
                                            <span class="fa-custom-filetype">{{f}}</span>
                                        </span>
                                    </a>
                                {% endif %}
                            {% endfor %}

                        </td>
                    </tr>
                    <tr>
                        <td>Survey</td>
                        <td>PI</td>
                        <td>Current Version</td>
                        <td>Number of Galaxies</td>
                        <td>Schema</td>
                        <td>Available Objects</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% if response.data.in_progress == True %}
        <div class="col-sm-12">
            <h2>Status</h2>
        </div>
        <div class="col-md-3 col-sm-3">
            <div class="panel panel-default">
                <div class="panel-heading text-uppercase">
                    <strong>In Progress</strong>
                    <i class="fa fa-refresh pull-right panel-icon"></i>
                </div>
                <div class="panel-body">
                    <p>GAMA data ingestion is underway!</p>
                </div>
            </div>
        </div>
    {% else %}

        <div class="col-sm-offset-3 col-sm-6 col-xs-12">
            <div class="panel panel-default panel-main-content">
                <div class="panel-heading">
                    <h3 class="panel-title">Data Browser</h3>
                </div>
                <div class="panel-body">
                    <p>Browse the available {{survey_name}} data for each object. Search for an
                        object below by either typing in the input box, or click an option.
                    <a href="" data-toggle="popover" data-html="true" class="popover-anchor" data-trigger="focus"
                data-content="<p>When typing the name of a particular object, the search results will display matches to the first character of the expression, followed by substring matches.</p>"
                data-placement="top"><i class="fa fa-info-circle"></i></a>
                    </p>
                    <div class="half-br"></div>
                    <select type="text" class="searchbox selectized text-center"
                            id="autocomplete-widget" placeholder="SEARCH">
                        <option value="" disabled selected>Select an object</option>
                        {% for key, value in response.data.astro_objects.items %}
                        <option value="{{value}}">{{key}}</option>
                        {% endfor %}
                    </select>
                    <a class="btn btn-block btn-primary" type="button" href="" disabled
                       id="autocomplete-button">GO</a>
                </div>
            </div>
        </div>

        <div class="col-sm-8 col-xs-12">
            <h3>What's Included?</h3>
        </div>
        <div class="col-sm-12 col-xs-12">
            <p>{% lorem 100 w %}</p>
        </div>

        <div class="col-sm-12 col-xs-12">
            <h3>About {{survey|uppercase}}</h3>
        </div>
        <div class="col-sm-12 col-xs-12">
            {% with "data_browser/survey/survey/"|add:survey|add:"/about.html" as template %}
                {% include template %}
            {% endwith %}
        </div>
    {% endif %}
</div>
<script>
    $(document).ready(function () {
        $selector = $("#autocomplete-widget").selectize({
            closeAfterSelect: true,
            selectOnTab: true,
            placeholder: "SEARCH...",
            create: false,
            maxItems: 1,
            onChange: function (value) {
                $('#autocomplete-button').attr('href', value).attr('disabled', false)
            }
        });
    });
</script>

{% endblock %}
{% block footer-extra %}
<script src="{% static 'restapi_app/js/selectize/selectize.js' %}"></script>
{% endblock %}

