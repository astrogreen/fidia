{% extends 'rest_framework/api.html' %}
{% load staticfiles %}
{% load rest_framework %}
{% load i18n %}
{% load internal_extras %}
{% block title %}Documentation{% endblock %}

{% block head-extra %}
<link rel="stylesheet" type="text/css" href="{% static 'restapi_app/css/documentation/documentation.css' %}"/>
{% endblock %}


<div class="container-fluid breadcrumb-container {% block breadcrumbclass %}{% endblock %}">
    <div class="container">
        {% block breadcrumbs-outer %}
        {% block breadcrumbs %}
        <ul class="breadcrumb ">
            <li><a href="{% url 'index' %}">Home</a></li>
            <li><a href="{% url 'documentation' %}">Documentation</a></li>
            <li class="active"><a href="{% url 'documentation-query-builder' %}">Query Builder</a></li>
        </ul>
        {% endblock %}
        {% endblock %}
    </div>
</div>

{% block content %}
<h1 class="headline">
    <span>Documentation</span>
</h1>
<div class="">
    <div class="row">
        <!--Nav Bar -->
        <div class="col-sm-2">
            {% block documentation-nav %}
            {% include "restapi_app/documentation/nav.html" %}
            {% endblock %}
        </div>
        <!--Main Content -->
        <div class="col-sm-10 col-xs-12">

            <section id="docs-query" class="group">
                <h2 class="headline">
                    <span>Query Builder</span>
                </h2>
                <div id="docs-query-builder" class="subgroup">
                    <div class="col-xs-12">
                        <p>
                            The Query Builder form allows you to construct complicated
                            queries on the database with ease without writing any
                            code. It provides available catalogues and columns easily
                            to reduce query mistakes and query construction time, allowing for
                            less SQL-writing and more data exploration.
                        </p>
                        <div class="docs-example">
                            <!--<img src="/static/images/documentation/GAMA-example0.png" class='img-responsive'-->
                            <!--alt="Screen shot of query">-->
                        </div>
                        <p><br>
                            Queries can be made on known survey objects or
                            at specific coordinates on the sky (RA, DEC). The query
                            builder is sufficient for most use cases, however particularly
                            complicated queries can be submitted via the SQL form.
                        </p><br>
                    </div>
                    <h4>SQL Syntax</h4>
                    <dl class="dl-horizontal">
                        <dt>Select</dt>
                        <dd>Select the catalogues you wish to query via the
                            <button class="btn btn-default btn-xs btn-demo" type="button">
                                Catalogue <span class="caret"></span></button>
                            dropdown.
                        </dd>
                        <dd>Available columns for the selected catalogue will be
                            shown in the
                            <button class="btn btn-default btn-xs btn-demo"
                                    type="button"> Columns <span class="caret"></span></button>
                            dropdown. If you are looking for a particular column, the
                            search bar can help.
                        </dd>
                        <dd>
                            Multiple catalogues can be added using the
                            <button class='btn btn-demo btn-circle'><span class='glyphicon
                         glyphicon-plus'></span></button>
                            Add Fields button. Currently,
                            up to 5 catalogues can be queried simultaneously.
                        </dd>
                        <dt>Join</dt>
                        <dd>If you have selected two or more catalogues to return results
                            from, use the Join row to choose which columns from each are
                            common fields. For example, you may want to return filtered
                            results from both the catalogues <samp>g3cgal</samp> and <samp>specobj</samp>.
                            In which case, you could join as:
                            <button class="btn btn-default btn-xs btn-demo"
                                    type="button"> G3CGAL.CATAID <span class="caret"></span></button>
                            <button class="btn btn-default btn-xs btn-demo"
                                    type="button"> INNER <span class="caret"></span></button>
                            <button class="btn btn-default btn-xs btn-demo"
                                    type="button"> SpecObj.CATAID <span class="caret"></span></button>
                            <br>
                            <strong>If you wish to return columns from
                                multiple catalogues, you must join the appropriate columns
                                from each catalogue</strong>.
                        </dd>
                        <br>
                        <dd>
                            Supported join types are detailed below.
                            <table class="table table-bordered">
                                <thead>
                                <tr>
                                    <th>
                                        Join
                                    </th>
                                    <th>
                                        Description
                                    </th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>
                                        <samp>INNER</samp>
                                    </td>
                                    <td>
                                        Limited to the rows that exist in both tables. For example,
                                        in our join above, a <samp>CATAID</samp> that
                                        appears in both <samp>g3cgal</samp> and <samp>specobj</samp> catalogues
                                        would be returned, however if a <samp>CATAID</samp>
                                        appeared in only one of <samp>g3cgal</samp> and <samp>specobj</samp>,
                                        it would not be returned. If you are unsure which join
                                        type to select, <samp>INNER</samp> is usually the best option.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <samp>LEFT</samp>
                                    </td>
                                    <td>
                                        All rows from the first (or left hand side) catalogue
                                        are preserved. Rows from the right hand catalogue will
                                        be returned <em>only</em> if they have a match in the
                                        left catalogue. Where there are values from the left
                                        catalogue and not the right, values will be set as
                                        <samp>NULL</samp>.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <samp>RIGHT</samp>
                                    </td>
                                    <td>
                                        All rows from the second (or right hand side) catalogue
                                        are preserved. Rows from the left hand catalogue will be
                                        returned <em>only</em> if they have a match in the right
                                        catalogue. Where there are values from the right catalogue
                                        and not the left, values will be set as <samp>NULL</samp>.
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <samp>OUTER</samp>
                                    </td>
                                    <td>
                                        A full outer join returns all rows from both catalogues,
                                        regardless of whether there are any matches. As in the
                                        <samp>LEFT</samp> and <samp>RIGHT</samp> joins, empty
                                        values will be set at NULL.
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </dd>
                        <dt>Filter</dt>
                        <dd>Set the constraints that determine which rows of the
                            above catalogues(s) will be returned by your query. Leaving this
                            empty will simply return all rows.
                        </dd>
                        <dd>To constrain a parameter
                            <samp>BETWEEN</samp> two values, simply separate by a
                            comma, for example to filter a column value between 0.1 and 0.3
                            enter <samp>0.1,0.3</samp> in the filter value input box.
                        </dd>
                        <dt>Results Format</dt>
                        <dd>Format the results file as <samp>ASCII</samp>,
                            <samp>CSV</samp> or <samp>FITS</samp>.
                        </dd>
                    </dl>
                </div>
                <div id="docs-query-builder-examples" class="subgroup">
                    <h3>Examples</h3>
                    <p>
                        Examples of various queries that can be constructed using the query form are shown here. If you
                        have an
                        impressive query constructed with the form that you would like us to feature, please let us
                        know.
                    </p>
                    <h4>Example 1</h4>
                    <p>Return all galaxies in a pair, with redshift (0.1 &#60;
                        z &#60; 0.3) and quality flag cut.</p>
                    <div class="row">
                        <div class="col-sm-6">
                            <table class="table table-bordered ">
                                <thead>
                                <tr>
                                    <th>DMU</th>
                                    <th>Catalogue</th>
                                    <th>Parameter</th>
                                    <th>Info</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <th scope="row">Groupfindingv05</th>
                                    <td>G3CGalsInPair</td>
                                    <td>Gal1CATAID, Gal2CATAID</td>
                                    <td>G3CGalsInPair is a catalogue of galaxies that
                                        live in pairs (thus gal1-gal2 and gal2-gal1 combinations
                                        are both listed), so here we need only match to
                                        Gal1CATAID.
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">StellarMassesv08</th>
                                    <td>StellarMasses</td>
                                    <td>CATAID, Z, nQ</td>
                                    <td>All CATAID matched to Gal1CATAID, where 0.1 &#60; Z &#60;
                                        0.3, nQ &#62; 2
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-sm-6">
                            <div class="docs-example">
                                <img src="{% static 'restapi_app/img/documentation/example1.png' %}"
                                     class='img-responsive'
                                     alt="Screen shot of query">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="docs-sql" class="subgroup">
                    <h3>SQL</h3>
                    <p></p>
                </div>
                <div id="docs-sql-examples" class="subgroup">
                    <h3>Examples</h3>
                    <p>
                        Examples of various queries that can be constructed using the query form are shown here. If you
                        have an
                        impressive query constructed with the form that you would like us to feature, please let us
                        know.
                    </p>
                    <h4>Example 1</h4>
                    <p>Return all galaxies in a pair, with redshift (0.1 &#60;
                        z &#60; 0.3) and quality flag cut.</p>
                    <div class="row">
                        <div class="col-sm-6">
                            <table class="table table-bordered ">
                                <thead>
                                <tr>
                                    <th>DMU</th>
                                    <th>Catalogue</th>
                                    <th>Parameter</th>
                                    <th>Info</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <th scope="row">Groupfindingv05</th>
                                    <td>G3CGalsInPair</td>
                                    <td>Gal1CATAID, Gal2CATAID</td>
                                    <td>G3CGalsInPair is a catalogue of galaxies that
                                        live in pairs (thus gal1-gal2 and gal2-gal1 combinations
                                        are both listed), so here we need only match to
                                        Gal1CATAID.
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">StellarMassesv08</th>
                                    <td>StellarMasses</td>
                                    <td>CATAID, Z, nQ</td>
                                    <td>All CATAID matched to Gal1CATAID, where 0.1 &#60; Z &#60;
                                        0.3, nQ &#62; 2
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-sm-6">
                            <div class="docs-example">
                                <img src="{% static 'restapi_app/img/documentation/example1.png' %}"
                                     class='img-responsive'
                                     alt="Screen shot of query">
                            </div>
                        </div>
                    </div>
                </div>

            </section>

        </div>
    </div>
</div>
{% endblock %}
{% block footer-extra %}
<script>
    $(document).ready(function () {
        //DOCS
        $('body').scrollspy({
            target: '.docs-sidebar',
            offset: 40
        });
    });
</script>
{% endblock %}