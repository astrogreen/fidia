{% extends 'base/base.html' %}
{# Load the tag library #}
{% load asvo_tags %}
{% load mathfilters %}
{% load bootstrap3 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

{# Display django.contrib.messages as Bootstrap alerts #}
{% bootstrap_messages %}

{% block title %} Query Form {% endblock %}
{% block wrapper %}
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
            <h2>Query <small>Return a sample of GAMA objects</small></h2>
                <p>
                    Whilst this node is development, the schema browser can be found at
                    <a href="http://www.gama-survey.org/dr2/schema/" target="_blank" class="btn btn-default btn-xs btn-info">
                        gama-survey.org
                    </a><br>
                    We encourage feedback
                    on the usefulness of this form in quickly generating a sample of objects from the database.
                    <br>
                    Please note that if your query is beyond the scope of the builder,
                    a separate SQL form will be provided to handle this.
                </p>
            </div>
            <div class="col-xs-12">
                <div class="form-container">
                <h4>Selection Criteria</h4>
                <form action="" method="post" class="form form-inline row" role="form" id="queryForm">
                    {% csrf_token %}
                    <div id="selectWrapper">
                        <div class="col-sm-2 col-xs-12 control-label">
                            <label for="select-input0" >Select Catalogue</label>
                        </div>
                        <div id="select-fields" class="col-sm-10 col-xs-12">
                                {% for fields in select_fields %}
                                    {% with forloop.counter|sub:1 as i %}
                                    {% with forloop.counter|sub:1|intdiv:2 as j %}
                                    {% if j < selectFieldsCount %}
                                        {% if i|divisibleby:2 == True %}
                                            <div id="select-input{{ j }}" class="select-input row form-group">
                                        {% endif %}
                                        {% if i|add:1|divisibleby:2 == True %}

                                                {% bootstrap_field fields show_label=False %}
                                                 <span class="">
                                                        {% if j == 0 %}
                                                        <button type="button" class="btn btn-default btn-success btn-xs add-remove add-field">Add another</button>
                                                        {% else %}
                                                            <button type="button" class="btn btn-danger btn-xs add-remove remove-field">
                                                              remove
                                                          </button>
                                                        {% endif %}
                                                 </span>
                                        {% else %}
                                            {% bootstrap_field fields show_label=False %}
                                        {% endif %}
                                        {% if i|divisibleby:2 == False %}
                                        </div>
                                        {% endif %}
                                    {% else %}

                                            {% bootstrap_field fields show_label=False %}

                                    {% endif %}
                                    {% endwith %}
                                    {% endwith %}
                                {% endfor %}
                        </div>

                    </div>
                    <div id="joinWrapper">
                        <div class="col-sm-2 col-xs-12 control-label">
                            <label for="join-input0" >Join</label>
                        </div>
                        <div id="join-fields" class="col-sm-10 col-xs-12 ">
                                {% for fields in join_fields %}
                                    {% with forloop.counter|sub:1 as i %}
                                    {% with forloop.counter|sub:1|intdiv:5 as j %}
                                                {% comment %} the indiv value is the number of fields required per row {% endcomment %}
                                    {% if j < joinFieldsCount %}
                                        {% if i|divisibleby:5 == True %}
                                            <div id="join-input{{ j }}" class="join-input row form-group">
                                        {% endif %}
                                        {% bootstrap_field fields show_label=False %}
                                        {% if i|add:1|divisibleby:5 == True %}
                                                {% comment %}
                                                    <span class="">
                                                        {% if j == 0 %}
                                                          <button type="button" class="btn btn-success btn-xs add-remove add-field">
                                                              +
                                                          </button>
                                                        {% else %}
                                                        <button type="button" class="btn btn-default add-remove remove-field" id="join-remove-{{j}}">
                                                              -
                                                          </button>
                                                        {% endif %}
                                                  </span>
                                                {% endcomment %}
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                    {% endwith %}
                                    {% endwith %}
                                {% endfor %}
                        </div>
                    </div>
                    <div id="filterShowHide" class="row">
                        <div class="col-sm-2 col-xs-12">
                            <a class="btn btn-default btn-info btn-xs text-uppercase pull-right" id='filterToggle' type="button">Add Filter</a><br><br>
                        </div>
                    </div>
                    <div id="filterWrapper">
                        <div class="col-sm-2 col-xs-12 control-label">
                            <label for="filter-input0">Filter</label>
                        </div>
                        <div id="filter-fields" class="col-sm-10 col-xs-12">
                                {% for fields in filter_fields %}
                                    {% with forloop.counter|sub:1 as i %}
                                    {% with forloop.counter|sub:1|intdiv:5 as j %}
                                                {% comment %} the indiv value is the number of fields required per row {% endcomment %}
                                    {% if j < filterFieldsCount %}
                                        {% if i|divisibleby:5 == True %}
                                            <div id="filter-input{{ j }}" class="filter-input row form-group">
                                        {% endif %}
                                                {% bootstrap_field fields show_label=False %}
                                        {% if i|add:1|divisibleby:5 == True %}
                                                    <span class="">
                                                        {% if j == 0 %}
                                                          <button type="button" class="btn btn-default btn-success btn-xs add-remove add-field">
                                                              add another
                                                          </button>
                                                        {% else %}
                                                            <button type="button" class="btn btn-default btn-danger btn-xs add-remove remove-field">
                                                              remove
                                                          </button>
                                                        {% endif %}
                                                  </span>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                    {% endwith %}
                                    {% endwith %}
                                {% endfor %}
                        </div>
                    </div>
                    {% comment %}
                    <div id="typeWrapper">
                        <div class="col-sm-1 col-xs-12 control-label">
                            <label for="type" >Format</label>
                        </div>
                        <div id="type-fields" class="col-sm-11">
                            <div class="row type-input form-group">
                                <div class="btn-group" data-toggle="buttons">
                                    {% for field in type_fields %}
                                    {% for x,y in field.field.choices %}
                                    <label class="btn btn-default">
                                        <input type="radio" name="{{ field.html_name }}" value="{{ x }}" /> {{ x }}
                                    </label>
                                    {% endfor %}

                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endcomment %}
                    <div class="row form-group">
                        <div class="col-xs-1 "><button class="btn btn-default" type="reset" id="queryReset">Reset</button></div>
                        <div class="col-xs-11"><button class="btn btn-primary pull-right" type="submit" id="querySubmit">Submit </button></div>
                    </div>
                </form>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="maxFieldsModal" role="dialog">
                    <div class="modal-dialog">
                      <!-- Modal content-->
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal">&times;</button>
                          <h4 class="modal-title">Warning</h4>
                        </div>
                        <div class="modal-body">
                          <p>Maximum number of fields allowed. Please use the SQL input box for a more sophisticated query.</p>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}